# ChatMQ
(Relatively) secure ZeroMQ IM chat with authorization and dialog history.

## Note
`/sha256` folder contains third-party code from [zedwood.com](http://www.zedwood.com/article/cpp-sha256-function) under Modified BSD License.

It was removed from current repository language indexation as `linguist-vendored`.

## Введение

На протяжении курса операционных систем и выполнения лабораторных работ были изучены многие особенности низкоуровневого взаимодействия систем и программного обеспечения друг с другом. В частности, были пройдены процессы клиент-серверного взаимодействия приложений. Именно эта тема показалась мне самой интересной и подтолкнула к идее реализации локального сервиса для обмена сообщениями.

## Задача

Реализовать мессенджер с авторизацией и хранением переписки для передачи сообщений между клиентами, используя MQ-сервер.

## Реализация

В качестве базового сервера обмена пакетами данных был выбран ZeroMQ, представляющий собой высокопроизводительную асинхронную библиотеку передачи сообщений, предназначенную для использования в распределенных или параллельных приложениях. Она реализует очередь сообщений, которая и используется в качестве парадигмы передачи данных.

Для шифрования логинов-паролей была использована сторонняя библиотека sha256, таким образом приводя структуру данных на сервере в следующий вид (например, для двух пользователей, общающихся друг с другом):

data
│   ├── 3e23e8160039594a33894f6564e1b1348bbd7a0088d42c4acb73eeaed59c009d          # директория пользователя
│   │   ├── dialogs                                                               # директория для хранения диалогов
│   │   │   └── ca978112ca1bbdcafac231b39a23dc4da786eff8147c4e72b9807785afee48bb  # файл диалога с другим пользователем
│   │   └── user.dat                                                              # информация о пользователе (подробнее ниже)
│   └── ca978112ca1bbdcafac231b39a23dc4da786eff8147c4e72b9807785afee48bb
│       ├── dialogs
│       │   └── 3e23e8160039594a33894f6564e1b1348bbd7a0088d42c4acb73eeaed59c009d
│       └── user.dat

Структура файла с информацией о пользователе представляется следующим образом:
* Хэш пароля
* Последнее время логина
* Количество оставшихся попыток на удачное залогинивание
* Состояние пользователя (online/offline)
* Статус пользователя (например, "Hello, World!")
* Хэш текущего собеседника

Основное управление терминальным мессенджером подразумевает, очевидно, использование команд.
Список команд, представленный при запуске клиента:
```
:create  ~ :delete      - create or delete account
:login   ~ :logout      - authorization management
:connect ~ :disconnect  - open chat with selected user
:status                 - set user status (i.e. "Hello, World!")
:quit                   - exit application
:help                   - print this manual
```

В качестве общения между приложением-сервером и клиентом используется, по-стандартному, С++ структура с такими данными как хэши, сообщения, информация о времени и т.д. **В следующих апдейтах ожидается поднятие защищенного соединения, стандарт которого предоставляет непосредственно ZeroMQ**. В таком случае это защитит передачу пакетов от MITM-атак.

## Задачи, требующие разрешения в следующих апдейтах

1. Устранение блокируемого ввода команд или введение отдельного потока, дабы появилась возможность получать instant-оповещения от сервера.
2. Как было сказано выше, шифрование (+ соль)
3. Поэкспериментировать с `ncurses`
4. ...
N. Тестирование и устранение багов.

Подробно ознакомиться с реализацией можно в source-файлах.

## Выводы

MQ - это, несомненно, компактная и очень удобная архитектура и ПО промежуточного уровня, которое занимается сбором, хранение и маршрутизацией (распределением) сообщений между компонентами. Ее интуитивная понятность позволяет программисту легко взаимодействовать с ней и использовать в собственных проектах.
Данная курсовая работа дала большой опыт в навыках понимания и реализации клиент-серверных приложений. Считаю, что выбор мессенджера в качестве курсовой оказался ненапрасным, так как смоделировал реально применения лабораторных задач.

